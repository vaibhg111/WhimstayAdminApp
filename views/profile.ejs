<!DOCTYPE html>
<html lang="en">

<head>
	<title>Admin-Profile</title>
	<style>
		form {
			margin: 20px 0;
		}

		form input,
		button {
			padding: 5px;
		}

		table {
			width: 70%;
			margin-bottom: 20px;
			border-collapse: collapse;
		}

		table,
		th,
		td {
			border: 1px solid #FC97B9;
		}

		table th,
		table td {
			padding: 10px;
			text-align: center;
		}
	</style>

</head>

<body id="page-top">
	<%- include header.ejs %>
	<div id="wrapper">
		<%- include sidenav.ejs %>
		<div id="content-wrapper">

			<div class="container-fluid">
				<input type="hidden" value="<%= data %>" id="userId">
				<input type="hidden" id="userProfileId" class="form-control">
				<div class="container">
					<div class="row">

						<div class="panel panel-defaul col-sm-12">
							<div class="panel-heading">
								<h6 class="text-blue">User Information to Update</h6>
							</div>
							<div class="panel-body">
								<div class="form-group">
									<div style="display:none;">

										<input type="text" class="form-control" id="userid" name="firstName"
											maxlength="50" onkeypress="return numberOnly(this, event)"
											placeholder="First Name...">
									</div>
									<div>
										<br>
										<label for="firstName">First Name:</label>
										<input type="text" class="form-control" id="firstName" name="firstName"
											maxlength="50" onkeypress="return numberOnly(this, event)"
											placeholder="First Name...">
									</div>

								</div>
								<span id="first" style="color:red;"></span>
								<div class="form-group">
									<label for="lastName">Last Name:</label>
									<input type="text" class="form-control" id="lastName" name="lastName" maxlength="50"
										onkeypress="return numberOnly(this, event)" placeholder="Last Name...">

								</div>
								<span id="last" style="color:red;"></span>
								<div class="form-group">
									<label for="email">Email:</label>
									<input type="email" class="form-control" id="emailId" name="email"
										placeholder="Enter Your Email...">

								</div>
								<span id="mail" style="color:red;"></span>
								<div class="form-group">
									<label for="mobileno">Mobile Number:</label>
									<input type="text" class="form-control margin-10px-bottom" id="mobileno1"
										name="mobileno">

								</div>
								<span id="mobile" style="color:red;"></span>
								<div class="form-group">
									<label for="mobileno">Birthdate:</label>
									<div class="row">
										<div class="col-md-5 no-margin-bottom">
											<select id="userDOBMonth" name="userDOBMonth"
												class="form-control margin-10px-bottom">
												<option disabled="" value="">Month</option>
												<option value="01">January</option>
												<option value="02">February</option>
												<option value="03">March</option>
												<option value="04">April</option>
												<option value="05">May</option>
												<option value="06">June</option>
												<option value="07">July</option>
												<option value="08">August</option>
												<option value="09">September</option>
												<option value="10">October</option>
												<option value="11">November</option>
												<option value="12">December</option>
											</select>
										</div>
										<div class="col-md-3 no-margin-bottom">
											<select id="userDOBDay" name="userDOBDay"
												class="form-control margin-10px-bottom">
												<option disabled="" value="">Day</option>
												<option value="01">1</option>
												<option value="02">2</option>
												<option value="03">3</option>
												<option value="04">4</option>
												<option value="05">5</option>
												<option value="06">6</option>
												<option value="07">7</option>
												<option value="08">8</option>
												<option value="09">9</option>
												<option value="10">10</option>
												<option value="11">11</option>
												<option value="12">12</option>
												<option value="13">13</option>
												<option value="14">14</option>
												<option value="15">15</option>
												<option value="16">16</option>
												<option value="17">17</option>
												<option value="18">18</option>
												<option value="19">19</option>
												<option value="20">20</option>
												<option value="21">21</option>
												<option value="22">22</option>
												<option value="23">23</option>
												<option value="24">24</option>
												<option value="25">25</option>
												<option value="26">26</option>
												<option value="27">27</option>
												<option value="28">28</option>
												<option value="29">29</option>
												<option value="30">30</option>
												<option value="31">31</option>
											</select>
										</div>
										<div class="col-md-4 no-margin-bottom">
											<select id="userDOBYear" name="userDOBYear"
												class="form-control margin-10px-bottom">
												<option disabled="" value="">Year</option>
												<option value="2018">2018</option>
												<option value="2017">2017</option>
												<option value="2016">2016</option>
												<option value="2015">2015</option>
												<option value="2014">2014</option>
												<option value="2013">2013</option>
												<option value="2012">2012</option>
												<option value="2011">2011</option>
												<option value="2010">2010</option>
												<option value="2009">2009</option>
												<option value="2008">2008</option>
												<option value="2007">2007</option>
												<option value="2006">2006</option>
												<option value="2005">2005</option>
												<option value="2004">2004</option>
												<option value="2003">2003</option>
												<option value="2002">2002</option>
												<option value="2001">2001</option>
												<option value="2000">2000</option>
												<option value="1999">1999</option>
												<option value="1998">1998</option>
												<option value="1997">1997</option>
												<option value="1996">1996</option>
												<option value="1995">1995</option>
												<option value="1994">1994</option>
												<option value="1993">1993</option>
												<option value="1992">1992</option>
												<option value="1991">1991</option>
												<option value="1990">1990</option>
												<option value="1989">1989</option>
												<option value="1988">1988</option>
												<option value="1987">1987</option>
												<option value="1986">1986</option>
												<option value="1985">1985</option>
												<option value="1984">1984</option>
												<option value="1983">1983</option>
												<option value="1982">1982</option>
												<option value="1981">1981</option>
												<option value="1980">1980</option>
												<option value="1979">1979</option>
												<option value="1978">1978</option>
												<option value="1977">1977</option>
												<option value="1976">1976</option>
												<option value="1975">1975</option>
												<option value="1974">1974</option>
												<option value="1973">1973</option>
												<option value="1972">1972</option>
												<option value="1971">1971</option>
												<option value="1970">1970</option>
												<option value="1969">1969</option>
												<option value="1968">1968</option>
												<option value="1967">1967</option>
												<option value="1966">1966</option>
												<option value="1965">1965</option>
												<option value="1964">1964</option>
												<option value="1963">1963</option>
												<option value="1962">1962</option>
												<option value="1961">1961</option>
												<option value="1960">1960</option>
												<option value="1959">1959</option>
												<option value="1958">1958</option>
												<option value="1957">1957</option>
												<option value="1956">1956</option>
												<option value="1955">1955</option>
												<option value="1954">1954</option>
												<option value="1953">1953</option>
												<option value="1952">1952</option>
												<option value="1951">1951</option>
												<option value="1950">1950</option>
												<option value="1949">1949</option>
												<option value="1948">1948</option>
												<option value="1947">1947</option>
												<option value="1946">1946</option>
												<option value="1945">1945</option>
												<option value="1944">1944</option>
												<option value="1943">1943</option>
												<option value="1942">1942</option>
												<option value="1941">1941</option>
												<option value="1940">1940</option>
												<option value="1939">1939</option>
												<option value="1938">1938</option>
												<option value="1937">1937</option>
												<option value="1936">1936</option>
												<option value="1935">1935</option>
												<option value="1934">1934</option>
												<option value="1933">1933</option>
												<option value="1932">1932</option>
												<option value="1931">1931</option>
												<option value="1930">1930</option>
												<option value="1929">1929</option>
												<option value="1928">1928</option>
												<option value="1927">1927</option>
												<option value="1926">1926</option>
												<option value="1925">1925</option>
												<option value="1924">1924</option>
												<option value="1923">1923</option>
												<option value="1922">1922</option>
												<option value="1921">1921</option>
												<option value="1920">1920</option>
												<option value="1919">1919</option>
												<option value="1918">1918</option>
												<option value="1917">1917</option>
												<option value="1916">1916</option>
												<option value="1915">1915</option>
												<option value="1914">1914</option>
												<option value="1913">1913</option>
												<option value="1912">1912</option>
												<option value="1911">1911</option>
												<option value="1910">1910</option>
												<option value="1909">1909</option>
												<option value="1908">1908</option>
												<option value="1907">1907</option>
												<option value="1906">1906</option>
												<option value="1905">1905</option>
												<option value="1904">1904</option>
												<option value="1903">1903</option>
												<option value="1902">1902</option>
												<option value="1901">1901</option>
												<option value="1900">1900</option>
												<option value="1899">1899</option>
												<option value="1898">1898</option>
											</select>
										</div>
										<input type="hidden" id="fullDob" name="dobDt">
										<center> <span id="dob" style="color:red;"></span></center>
									</div>
								</div>
							</div>
							<input type="hidden" id="dobDt" class="form-control">
							<input type="hidden" id="mobileno" class="form-control">
							<input type="hidden" id="userProfileId" class="form-control">
							<input type="hidden" id="dialerCode" class="form-control">
							<div class="row">
								<div class="col-md-4">
									<button type="button" id="saveBtn" href="#" data-toggle="modal"
										data-target="#updateModal"
										class="btn btn-blue btn-rounded btn-large width-100">Save</button>
								</div>
								<div class="col-md-4">
									<button type="button" href="#" data-toggle="modal" data-target="#inactiveModal"
										class="btn btn-blue btn-rounded btn-large width-100">Inactivate
										User</button>
								</div>
								<div class="col-md-4">
									<button type="button" href="#" data-toggle="modal" data-target="#deleteModal"
										class="btn btn-blue btn-rounded btn-large width-100">Delete</button>
								</div>
							</div>
							<br><br>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Update Modal -->
	<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Update?</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Are you sure you want to update this user?</div>
				<div class="modal-footer">
					<button class="btn btn-secondary btn-rounded" type="button" data-dismiss="modal">Cancel</button>
					<button class="btn btn-blue btn-rounded" id="updateDetails">Update</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Delete?</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Are you sure you want to delete this user?</div>
				<div class="modal-footer">
					<button class="btn btn-secondary btn-rounded" type="button" data-dismiss="modal">Cancel</button>
					<a class="btn btn-blue btn-rounded" id="deleteDetails" href="">Delete</a>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="inactiveModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Inactivate User?</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Are you sure you want to inactivate this user?</div>
				<div class="modal-footer">
					<button class="btn btn-secondary btn-rounded" type="button" data-dismiss="modal">No</button>
					<button class="btn btn-blue btn-rounded" id="inactiveDetails">Yes</button>
				</div>
			</div>
		</div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="../public/javascripts/validate.js"></script>
	<script>
		var baseURL = globalUrl;
		$("#userDOBYear,#userDOBMonth,#userDOBDay").change(function () {
			getStartDate();
		});
		function getStartDate() {
			var startAth = $("#userDOBYear").val();
			if (startAth === "") {
				$("#fullDob").val('');
				// console.log("start at hours missing");
				return;
			}
			var startAtm = $("#userDOBMonth").val();
			if (startAtm == "") {
				$("#fullDob").val('');
				//   console.log("start at minutes missing");
				return;
			}
			var startAtam = $("#userDOBDay").val();
			if (startAtm == "") {
				$("#fullDob").val('');
				//  console.log("start at AM/PM missing");
				return;
			}
			var startDate = startAth + "-" + startAtm + "-" + startAtam;
			$("#fullDob").val(startDate);
		}

		$(document).ready(function () {
			var fullname = sessionStorage.getItem('fullName');
			var name = fullname.split(" ");
			document.getElementById("firstName").value = name[0];
			document.getElementById("lastName").value = name[1];
			document.getElementById("emailId").value = sessionStorage.getItem('emailId');
			document.getElementById("mobileno1").value = sessionStorage.getItem('mobileNo');
			document.getElementById("fullDob").value = sessionStorage.getItem('birthdate');
			document.getElementById("userid").value = sessionStorage.getItem('userId');
			var date = document.getElementById("fullDob").value;
			var parts = date.split("-");
			document.getElementById("userDOBYear").value = parts[2];
			document.getElementById("userDOBMonth").value = parts[0];
			document.getElementById("userDOBDay").value = parts[1];
		});

		$('#saveBtn').click(function () {
			var u = document.getElementById("firstName").value;
			if (u == "") {
				document.getElementById("first").innerHTML = 'Please enter your First Name.';
				document.getElementById("firstName").focus();
				return false;
			}
			else {
				document.getElementById("first").innerHTML = "";
			}

			/* For Last name field validation*/
			var u = document.getElementById("lastName").value;
			if (u == "") {
				document.getElementById("last").innerHTML = 'Please enter your Last Name.';
				document.getElementById("lastName").focus();
				return false;
			}
			else {
				document.getElementById("last").innerHTML = "";
			}

			/* For Email Id field validation*/
			var mailid = document.getElementById("emailId").value;
			if (mailid == "") {
				document.getElementById("mail").innerHTML = 'Please enter your email Id.';
				document.getElementById("emailId").focus();
				return false;
			}
			else {
				document.getElementById("mail").innerHTML = "";
			}

			var v = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			if (v.test(emailId.value) == false) {
				document.getElementById("mail").innerHTML = 'Invalid Email Address.';
				email.focus();
				return false;
			} else {
				document.getElementById("mail").innerHTML = "";
			}
			// For mobile number field
			var mob = document.getElementById("mobileno1").value;
			if (mob == "") {
				document.getElementById("mobile").innerHTML = 'Please enter your mobile number';
				document.getElementById("mobileno1").focus();
				return false;
			}
			else {
				document.getElementById("mobile").innerHTML = "";
			}
			var r = 0;
			for (y = 0; y < mob.length; y++) {
				if ((mob.charCodeAt(y) >= 32 && mob.charCodeAt(y) <= 47) || (mob.charCodeAt(y) >= 58 && mob.charCodeAt(y) <= 255) || (mob.charCodeAt(y) >= 338 && mob.charCodeAt(y) <= 402) || (mob.charCodeAt(y) >= 8211 && mob.charCodeAt(y) <= 8482)) {
					r++;
				}
			}
			if (r != 0) {
				document.getElementById("mobile").innerHTML = 'Please enter only numeric values in Mobile Number.';
				document.getElementById("mobileno1").focus();
				return false;
			}

			else {
				document.getElementById("mobile").innerHTML = "";
			}

			if (mob.length > 10 || mob.length < 10) {
				document.getElementById("mobile").innerHTML = 'Mobile number should be of 10 digits';
				document.getElementById("mobileno1").focus();
				return false;
			} else { }
			// Date of Birth Validation
			var chkdate = document.getElementById("fullDob").value;
			if (document.getElementById("fullDob").value == "") {

				document.getElementById("dob").innerHTML = 'Please enter the Date of Birth..!!';
				document.getElementById("fullDob").focus();
				return false;
			}
			// else if (!chkdate.match(/^((((19|[2-9]\d)\d{2})\-(0[13578]|1[02])\-(0[1-9]|[12]\d|3[01]))|(((19|[2-9]\d)\d{2})\-(0[13456789]|1[012])\-(0[1-9]|[12]\d|30))|(((19|[2-9]\d)\d{2})\-02\-(0[1-9]|1\d|2[0-8]))|(((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))\-02\-29))$/g)) {
			// 	document.getElementById("dob").innerHTML = 'Please enter the Valid Date of Birth..!!';
			// 	document.getElementById("fullDob").focus();
			// 	return false;
			// } 
			else { }
			// Date of Birth 18 years old Validation
			var x = new Date($("#fullDob").val());
			var Cnow = new Date();
			if ($("#fullDob").val() == "") {
				$("#fullDob").focus();
			}
			else if (Cnow.getFullYear() - x.getFullYear() < 18) {
				document.getElementById("dob").innerHTML = 'Sorry you are not eligible for Whimstay because you are not 18 years old';
				document.getElementById("fullDob").focus();
				return false;
			}
			else { }
		});

		$('#updateDetails').click(function () {
			var date = document.getElementById("fullDob").value;
			var dobDt = moment(date).format("YYYY-MM-DD");
			var userProfile = new Object();
			userProfile.userId = document.getElementById("userid").value;
			userProfile.firstName = document.getElementById("firstName").value;
			userProfile.lastName = document.getElementById("lastName").value;
			userProfile.emailId = document.getElementById("emailId").value;
			userProfile.mobileno1 = document.getElementById("mobileno1").value;
			userProfile.dobDt = dobDt;
			userProfile.apiUserType = "admin";

			console.log(JSON.stringify(userProfile));

			$.ajax({
				type: 'PUT',
				//data: person,
				data: JSON.stringify(userProfile),
				contentType: "application/json",
				headers: {
					"content-type": "application/json",
					Authorization: localStorage.getItem('token') || ''
				},
				dataType: 'json',
				url: baseURL + 'v1/user',
				success: function (result) {
					location.href = "/propertyUserDetails";
				},
				error: function (xhr, textStatus, errorThrown) {

					console.log("Record not Saved");
				}
			});
		});

		$('#inactiveDetails').click(function () {
			$.ajax({
				url: baseURL + 'v1/user/' + document.getElementById("userid").value + '/deactive',
				type: 'DELETE',
				contentType: "application/json",
				headers: {
					"content-type": "application/json",
					Authorization: localStorage.getItem('token') || ''
				},
				dataType: 'json',
			}).done(function (result) {
				location.href = "/propertyUserDetails";
			}).fail(function (a, b, c) {
				console.log(a, b, c);
			});
		});

	</script>
	<script>

		function numberOnly(txt, e) {
			var arr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz- ";
			var code;
			if (window.event)
				code = e.keyCode;
			else
				code = e.which;
			var char = keychar = String.fromCharCode(code);
			if (arr.indexOf(char) == -1)
				return false;

		}
	</script>
	<!-- /.container-fluid -->

	</div>
	<!-- /.content-wrapper -->

	</div>
	<!-- /#wrapper -->

	<%- include footer.ejs %>

</body>

</html>